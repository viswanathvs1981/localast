Metadata-Version: 2.1
Name: localast
Version: 0.1.0
Summary: Local-first scaffolding for the Local Code Brain architecture
Author: LocalAST Contributors
Requires-Python: >=3.11
Description-Content-Type: text/markdown

# LocalAST

LocalAST is a comprehensive local code intelligence platform that provides semantic
search, git history tracking, and AI-powered code assistance through MCP (Model Context Protocol).
Everything runs entirely on your laptop - no cloud services required.

## Features

### Core Capabilities
- **Multi-Language Support**: Python, C#, JavaScript/TypeScript, Bicep, Go, and more
- **Multi-Repository Support**: Index and search across multiple git repositories
- **Semantic Search**: Vector embeddings for intelligent code and documentation search
- **Git History Tracking**: Complete commit history and change tracking
- **MCP Server**: Expose tools for AI agents (Claude, Cursor, etc.)
- **Full-Text Search**: Fast symbol and documentation lookup
- **Documentation Linking**: Automatic detection of code ↔ documentation relationships
- **Local-First**: All data stays on your machine, using SQLite
- **Extensible**: Easy to add support for new languages

### Enhanced Code Intelligence
- **Hierarchical Symbol Analysis**: Navigate nested classes, methods, and inner functions
- **Call Graph Tracking**: Understand what calls what (forward and backward traversal)
- **Dependency Graphs**: Track imports and file dependencies at any depth
- **Configuration Management**: Index, compare, and analyze JSON/YAML/XML configs
- **Repository Structure Analysis**: Browse file trees with symbol counts and complexity metrics
- **Method-Level Context**: Get dependencies for specific functions/methods
- **Configuration Comparison**: Diff configs between environments or versions

See [ENHANCED_FEATURES.md](ENHANCED_FEATURES.md) for detailed documentation.

## Project layout

```
.
├── db/schema.sql           # SQLite schema for all modules (AST, Prompt Lab, review)
├── examples/               # Sample review policies and prompt metrics
├── scripts/init_db.py      # Helper script to bootstrap the local database
├── src/localast/           # Python package housing modular scaffolding
└── tests/                  # Pytest-based validation of the schema
```

Each package under `src/localast/` mirrors a major component of the design
specification (AST, graph, embeddings, temporal store, review engine, etc.).
The implementations are intentionally lightweight so that new contributors can
extend them without first wiring external services.

## Prerequisites

* Python 3.11+
* `sqlite3` command-line tools (bundled with Python on most platforms)

## Supported Languages

**Tier 1 (Full AST Parsing):**
- Python (built-in `ast` module)
- JavaScript/TypeScript (tree-sitter)
- C# (tree-sitter + regex fallback)

**Tier 2 (Regex Pattern Matching):**
- Bicep (resource, module, param, output, var)
- Go (func, type, interface)
- Java, C/C++, Rust, Ruby, PHP (extensible)

Adding support for new languages is straightforward - see `src/localast/ast/parser.py`.

## Quick Start

1. **Install LocalAST:**

```bash
# Run the install script (creates venv and installs dependencies)
./install.sh

# Or manually:
python -m venv .venv
source .venv/bin/activate  # On Windows: .venv\Scripts\activate
pip install --upgrade pip
pip install -r requirements.txt
pip install -e .
```

2. **Initialize the database:**

```bash
python scripts/init_db.py
```

3. **Index a repository:**

```bash
# Add a repository
localast repo add /path/to/your/repo --name my-project

# Index it (code + docs + git history + embeddings)
localast index repo my-project --embed

# View stats
localast repo info
```

4. **Start the MCP server for AI agents:**

```bash
localast serve
```

Then add to your VSCode/Cursor `mcp.json`:

```json
{
  "mcpServers": {
    "localast": {
      "command": "localast",
      "args": ["serve"]
    }
  }
}
```

## Initialising the local database

The repository ships with a schema file that mirrors the data model from the
spec. To create the SQLite database in `~/.localast/localast.db`, run:

```bash
python scripts/init_db.py
```

You can choose a custom location by passing `--database`:

```bash
python scripts/init_db.py --database ./tmp/localast.db
```

The script does not reach out to the network; it only creates directories and
executes SQL locally.

## Command-Line Interface

### Repository Management

```bash
# Add a repository
localast repo add /path/to/repo --name my-project

# List all registered repositories
localast repo list

# Remove a repository
localast repo remove my-project

# Get overall stats
localast repo info
```

### Indexing

```bash
# Full repository indexing (code + docs + git history)
localast index repo my-project --embed

# Incremental reindex (detects changes)
localast reindex my-project

# Index just code (legacy command)
localast index code src/ --reindex

# Index just documentation (legacy command)
localast index docs docs/ --repo-root .
```

### MCP Server

```bash
# Start the MCP server for AI agents
localast serve
```

## MCP Tools Available to AI Agents

Once the MCP server is running, AI agents can use these tools:

### Search Tools
- `search_code` - Search symbols by name (full-text)
- `search_semantic` - Semantic search using embeddings
- `search_documentation` - Search docs (full-text)
- `find_references` - Find documentation referencing code
- `search_across_repos` - Search across all repositories

### Context Tools
- `get_symbol_info` - Get detailed symbol information
- `get_file_context` - Get file contents with line numbers
- `get_documentation` - Get linked documentation
- `list_symbols_in_file` - List all symbols in a file
- `get_symbol_definition` - Get exact code definition

### Git History Tools
- `get_changes_between_commits` - Diff between commits
- `find_when_introduced` - When was a symbol/file added
- `get_recent_changes` - Recent commits affecting code
- `get_commit_details` - Full commit information
- `blame_line` - Who last changed specific lines

### Repository Tools
- `list_repositories` - Show all indexed repos
- `get_repo_stats` - Detailed repository statistics

### Hierarchical Code Analysis Tools ✨ NEW
- `get_symbol_tree` - Get nested class/method/function hierarchy
- `get_call_graph` - Visualize what calls what (forward/backward)
- `get_dependencies` - Track file imports and dependencies
- `get_symbol_dependencies` - Get all dependencies for a symbol

### Configuration Management Tools ✨ NEW
- `get_config_tree` - View hierarchical config structure
- `compare_configs` - Compare two config files (JSON/YAML/XML)
- `search_config_value` - Find config values across files
- `get_config_by_key_path` - Find specific config keys everywhere
- `list_config_files` - List all indexed configuration files

### Repository Structure Tools ✨ NEW
- `get_repo_tree` - Browse repository file structure
- `get_file_tree_with_symbols` - File tree with complexity metrics
- `get_directory_stats` - Statistics for any directory
- `find_largest_files` - Find most complex files by symbol count
- `search_files_by_name` - Search files by name/pattern

## Testing and validation

Automated validation relies on `pytest` and the in-memory SQLite engine. Tests
can be executed locally with:

```bash
pytest
```

The suite verifies that the schema can be applied and that key tables are
present. Because everything runs on the local interpreter, no Azure resources
or network calls are involved.

## Use Cases

### For AI Agents (Claude, Cursor, etc.)

**Code Search & Context:**
- "Search for authentication code across all my repos"
- "Get me the full context of the database connection logic"
- "Find similar error handling patterns"

**Code Structure & Dependencies:**
- "Show me the class structure of UserService"
- "What functions does process_payment call?"
- "Where is authenticate_user called from?"
- "What files does auth.py depend on?"
- "List all methods in the PaymentController class"

**Configuration Management:**
- "Compare staging and production database configs"
- "Find all configuration files using port 8080"
- "Show me the structure of config.json"
- "What's different between dev and prod configs?"

**Git History:**
- "What changed in the payment module in the last 10 commits?"
- "When was the User class introduced?"
- "Show me recent changes to authentication"

**Repository Analysis:**
- "Which files are most complex in this repo?"
- "Show me the project structure"
- "Find all test files"
- "What languages are used in src/?"

### For Developers
- Semantic search across multiple projects
- Track code evolution over time
- Link documentation to code automatically
- Find similar code patterns
- Understand cross-repository dependencies

## Architecture

```
┌─────────────────────────────────────────────────────────┐
│                     LocalAST                             │
│                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐ │
│  │   CLI Tools  │  │  MCP Server  │  │  Embeddings  │ │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘ │
│         │                 │                  │         │
│  ┌──────▼─────────────────▼──────────────────▼───────┐ │
│  │              SQLite Database                      │ │
│  │  • Repos  • Files  • Symbols  • Commits          │ │
│  │  • Embeddings  • Docs  • Changes  • FTS          │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
└─────────────────────────────────────────────────────────┘
                       ▲
                       │
        ┌──────────────┴──────────────┐
        │                             │
    Git Repos               AI Agents (VSCode/Cursor)
```

## Database Schema

- `repo` - Registered git repositories
- `files` - Source files with hashes
- `symbols` - Functions and classes
- `version` - Commit metadata
- `change_event` - File changes per commit
- `blob` - Documentation content
- `emb` - Vector embeddings (384-dim)
- `edges` - Code ↔ documentation links
- `ident_fts` - Full-text search for symbols
- `doc_fts` - Full-text search for docs

## Supported Languages by Extension

| Extension | Language | Parser Method |
|-----------|----------|---------------|
| `.py`, `.pyw` | Python | Built-in AST |
| `.js`, `.jsx` | JavaScript | Tree-sitter |
| `.ts`, `.tsx` | TypeScript | Tree-sitter |
| `.cs` | C# | Tree-sitter + Regex |
| `.bicep` | Bicep | Regex patterns |
| `.go` | Go | Regex patterns |
| `.java` | Java | Regex patterns |
| `.cpp`, `.cc`, `.cxx`, `.c`, `.h` | C/C++ | Regex patterns |
| `.rs` | Rust | Regex patterns |
| `.rb` | Ruby | Regex patterns |
| `.php` | PHP | Regex patterns |

## Future Enhancements

- Tree-sitter parsers for more languages (Go, Rust, Java, etc.)
- Incremental git updates (hooks)
- Incident management integration
- Grafana/observability data linkage
- CI/CD pipeline integration
- Call graph analysis (cross-language)
- Dependency tracking

## Examples

See `examples/` directory for:
- `prompt_metrics.json` - Prompt evaluation metrics
- `review_policy.json` - Code review policy rules
